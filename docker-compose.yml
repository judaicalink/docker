version: '0.1'
name: 'judaicalink'
services:
  judaicalink:
      build: .
      ports:
        - "80:80"
        - "443:443"
        - "1313:1313"
        - "3030:3030"
        - "8000:8000"
        - "8001:8001"
      volumes:
        - type: volume
          source: judaicalink
          target: /data
      privileged: true
      image: judaicalink/judaicalink
      container_name: judaicalink

# Will be replaced with solr
  elasticsearch:
    image: 'elasticsearch:2.4'
    ports:
      - "9200:9200"
      - "9300:9300"
    environment:
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    volumes:
      - es_data:/usr/share/elasticsearch/data

  kibana:
    image: 'kibana:4.6'
    ports:
      - "5601:5601"
    links:
      - elasticsearch
    environment:
      - "ELASTICSEARCH_URL=http://elasticsearch:9200"

  NGINX:
    image: 'nginx:stable-alpine3.17'
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    links:
      - judaicalink
    depends_on:
      - judaicalink

  solr:
    image: 'solr:8.11.2'
    ports:
      - "8983:8983"
    volumes:
      - ./solr:/opt/solr/server/solr/mycores
    links:
      - judaicalink
    depends_on:
      - judaicalink

volumes:
    db_data:
      driver: local

    es_data:
        driver: local

    fuseki_data:
        driver: local

    judaicalink:
        driver: local
